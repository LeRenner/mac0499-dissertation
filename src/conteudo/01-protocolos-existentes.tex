%!TeX root=../tese.tex
%("dica" para o editor de texto: este arquivo é parte de um documento maior)
% para saber mais: https://tex.stackexchange.com/q/78101

\chapter{Implementações já existentes}

No desenvolvimento de um protocolo de mensagens descentralizado, o primeiro passo essencial é analisar as soluções de código aberto já existentes. Essas implementações fornecem uma base para compreender os desafios práticos, as abordagens de arquitetura e as estratégias de mitigação de problemas que foram desenvolvidas e testadas pela comunidade. Os protocolos analisados foram selecionados por serem abertos, descentralizados, e por terem uma arquitetura de rede singular, sendo relevante para este estudo. Os protocolos analisados foram categorizados pela sua arquitetura de rede, e divididos em quatro grupos principais: federados, peer-to-peer com relays que usam tor, peer-to-peer com relays que não usam tor, e peer-to-peer sem relays. 

Relays são servidores intermediários que encaminham mensagens entre usuários, e são utilizados para contornar restrições de rede, como NATs e firewalls. A rede Tor é uma rede de anonimização que permite a comunicação anônima e segura entre usuários, mesmo quando eles estão em redes censuradas, com NATs, ou com firewalls restritivos.

Os protocolos analisados federados são:
\begin{itemize}
  \item \href{https://matrix.org/}{Matrix}
  \item \href{https://xmpp.org/}{XMPP}
  \item \href{https://en.wikipedia.org/wiki/Email}{E-Mail}
\end{itemize}

Os protocolos analisados peer-to-peer com relays que não usam Tor são:
\begin{itemize}
  \item \href{https://simplex.chat/}{SimpleX}
  \item \href{https://www.irc.org/}{IRC}
  \item \href{https://lora-alliance.org/}{LoRaWan}
\end{itemize}

Os protocolos analisados peer-to-peer com relays que usam Tor são:
\begin{itemize}
  \item \href{https://cwtch.im/}{Cwtch}
  \item \href{https://ricochet.im/}{Ricochet}
  \item \href{https://briarproject.org/}{Briar}
\end{itemize}

Os protocolos analisados peer-to-peer sem relays são:
\begin{itemize}
  \item \href{https://scuttlebutt.nz/}{Secure Scuttlebutt}
  \item \href{https://tox.chat/}{Tox}
  \item \href{https://bitmessage.org/}{Bitmessage}
\end{itemize}

A análise de cada protocolo é focada na arquitetura de rede, e não considera em detalhes outras funcionalidades como chamadas de voz, videoconferência, ou compartilhamento de arquivos. A seguir, são apresentadas as análises dos protocolos selecionados.

\section{Protocolos Federados}

Na arquitetura federada de envio de mensagens, os usuários escolhem servidores específicos para armazenar e transmitir suas mensagens. Esses servidores se comunicam entre si para rotear as mensagens destinadas a usuários em outros servidores. Como o servidor é responsável pela entrega das mensagens, os protocolos federados permitem o envio assíncrono de mensagens. Em geral, os endereços dos usuários nesses sistemas consistem em um nome de usuário combinado com o endereço do servidor.

\subsection{Matrix}

O protocolo Matrix é um sistema de comunicação descentralizado e federado projetado para suportar mensagens instantâneas e colaboração em tempo real. Desenvolvido para ser uma solução aberta e interoperável, o Matrix visa fornecer uma infraestrutura robusta para comunicação em diversos contextos, desde chat e chamadas de voz até a troca de arquivos \cite{matrixspec}.

\begin{itemize}
  \item \textbf{Tipo de endereço}: @usuário:servidor
  \item \textbf{Suporte a criptografia de ponta a ponta}: Sim
\end{itemize}

\subsection{XMPP}

O protocolo XMPP (Extensible Messaging and Presence Protocol) é um protocolo federado de mensagens instantâneas e presença. Desenvolvido originalmente pela Jabber Inc., o XMPP é um protocolo aberto e extensível que permite a comunicação entre diferentes servidores e clientes \cite{xmppspec}.

\begin{itemize}
  \item \textbf{Tipo de endereço}: usuário@servidor
  \item \textbf{Suporte a criptografia de ponta a ponta}: Sim
\end{itemize}

\subsection{E-Mail}

O E-Mail é um protocolo de comunicação assíncrona que permite o envio e recebimento de mensagens de texto, anexos e outros arquivos \cite{rfc5321}.

\begin{itemize}
  \item \textbf{Tipo de endereço}: usuário@servidor
  \item \textbf{Suporte a criptografia de ponta a ponta}: Sim
\end{itemize}

\section{Protocolos Peer-to-Peer com Relays}

Na arquitetura peer-to-peer com relays, os usuários se conectam diretamente uns aos outros, e armazenam localmente suas mensagens. Para contornar limitações de rede, como camadas de Network Adress Translation (NAT) e firewalls, os usuários podem usar relays para intermediar a comunicação. Os relays são apenas responsáveis por encaminhar diretamente as mensagens, as apagando quando elas são entregues. Em alguns protocolos, esses relays podem armazenar a mensagem por um curto período de tempo, até o destinatário estar disponível para recebê-la.

Alguns desses protocolos utilizam como relay a rede Tor, que é uma rede de anonimização que permite a comunicação anônima e segura entre usuários, mesmo quando eles encontram-se em redes censuradas, com NATs, ou com firewalls restritivos.

\subsection{Protocolos Peer-to-Peer com Relays que não usam Tor}

\subsubsection{SimpleX}

O SimpleX é um protocolo de mensagens instantâneas peer-to-peer que utiliza relays para intermediar a comunicação entre usuários. Sua característica distinta é a sua completa ausência de um identificador de usuário, de modo que usuários podem iniciar uma conversa utilizando um simples código de convite \cite{simplex}.

\begin{itemize}
  \item \textbf{Tipo de endereço}: Código de convite
  \item \textbf{Suporte a criptografia de ponta a ponta}: Sim
  \item \textbf{Assíncrono}: Sim
\end{itemize}

\subsubsection{IRC}

O IRC (Internet Relay Chat) é um protocolo de comunicação em tempo real que permite a troca de mensagens em canais de chat específicos. As mensagens só podem ser recebidas de forma síncrona, uma vez que o servidor se comporta como um broadcast, enviando as mensagens para todos os usuários conectados \cite{rfc2810}.

\begin{itemize}
  \item \textbf{Tipo de endereço}: endereço de servidor
  \item \textbf{Suporte a criptografia de ponta a ponta}: A maioria dos clientes não suporta
  \item \textbf{Assíncrono}: Não
\end{itemize}

\subsubsection{LoRaWan}

O LoRaWan é um protocolo de comunicação de longo alcance e baixa potência que permite a comunicação entre dispositivos de Internet of Things (IoT). O protocolo se utiliza tanto de LoRa, que é uma tecnologia de modulação de rádio, quanto de redes de relays para transmitir mensagens entre dispositivos pela internet \cite{lorawan}.

\begin{itemize}
  \item \textbf{Tipo de endereço}: endereço de dispositivo
  \item \textbf{Suporte a criptografia de ponta a ponta}: Sim
  \item \textbf{Assíncrono}: Sim
\end{itemize}

\subsection{Protocolos Peer-to-Peer com Relays que usam Tor}

\subsubsection{Cwtch}

O Cwtch é um protocolo de mensagens instantâneas peer-to-peer que utiliza a rede Tor para intermediar a comunicação entre usuários. Cada usuário roda um serviço oculto no tor, e os usuários se conectam diretamente uns aos outros através da rede Tor \cite{cwtch}.

\begin{itemize}
  \item \textbf{Tipo de endereço}: Endereço do serviço oculto
  \item \textbf{Suporte a criptografia de ponta a ponta}: Sim
  \item \textbf{Assíncrono}: Não
\end{itemize}

\subsubsection{Ricochet}

O Ricochet funciona de maneira muito similar ao Cwtch. Ele utiliza a rede Tor para intermediar a comunicação entre usuários, e não requer um servidor central para funcionar \cite{ricochet}.

\begin{itemize}
  \item \textbf{Tipo de endereço}: Endereço do serviço oculto
  \item \textbf{Suporte a criptografia de ponta a ponta}: Sim
  \item \textbf{Assíncrono}: Não
\end{itemize}

\subsubsection{Briar}

O Briar é um protocolo muito versátil, e que permite o envio de mensagens através de Bluetooth, Wi-Fi, ou da internet. Quando as mensagens são enviadas pela internet, ele utiliza a rede Tor para intermediar a comunicação entre usuários, e é capaz de funcionar mesmo em redes censuradas \cite{briar}.

\begin{itemize}
  \item \textbf{Tipo de endereço}: Chave pública e privada (por meio de um QR code)
  \item \textbf{Suporte a criptografia de ponta a ponta}: Sim
  \item \textbf{Assíncrono}: Sim (com um dispositivo secundário rodando o serviço Briar Mailbox)
\end{itemize}

\section{Protocolos Peer-to-Peer sem Relays}

Na arquitetura peer-to-peer sem relays, os usuários se conectam diretamente, ou através de outros usuários, mas o protocolo não tem computadores dedicados para o intermédio de mensagens. Em geral, esses protocolos precisam que o usuário inicialmente saiba o endereço de outros usuários para poder se comunicar com eles, e estes protocolos são mais vulneráveis a restrições na rede, como NATs e firewalls.

\subsection{Secure Scuttlebutt}

O Secure Scuttlebutt é um protocolo de rede social descentralizada, que também permite o envio de mensagens privadas entre usuários. Nele, os usuários armazenam as próprias mensagens, e as replicam para outros usuários que estão conectados a eles. Geralmente, usuários vão receber um endereço de um amigo para se conectar, e a partir daí vão receber mensagens de amigos de amigos, e assim por diante \cite{scuttlebutt}.

\begin{itemize}
  \item \textbf{Tipo de endereço}: endereço, porta e chave pública
  \item \textbf{Suporte a criptografia de ponta a ponta}: Sim
  \item \textbf{Assíncrono}: Sim, por meio de replicação de mensagens
\end{itemize}

\subsection{Tox}

O tox é um protocolo de mensagens que primariamente não utiliza servidores intermediários, mas que pode recorrer a relays quando ambos os usuários não podem receber conexões externas. Ele permite o envio de mensagens, chamadas de voz e videoconferência \cite{toxcore}.

\begin{itemize}
  \item \textbf{Tipo de endereço}: Chave pública
  \item \textbf{Suporte a criptografia de ponta a ponta}: Sim
  \item \textbf{Assíncrono}: Não
\end{itemize}

\subsection{Bitmessage}

Bitmessage é um protocolo que apresenta similaridades com o Bitcoin, uma vez que usuários precisam resolver um desafio de prova de trabalho para enviar mensagens. Nele, mensagens percorrem a rede inteira até chegar ao destinatário \cite{bitmessage}.

\begin{itemize}
  \item \textbf{Tipo de endereço}: Chave pública
  \item \textbf{Suporte a criptografia de ponta a ponta}: Sim
  \item \textbf{Assíncrono}: Sim
\end{itemize}

